name: ğŸš€ Deploy to Vercel

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Select deployment environment'
        required: true
        default: 'preview'
        type: choice
        options:
          - preview
          - production
      confirm:
        description: 'Type "DEPLOY" to confirm'
        required: false
        default: 'DEPLOY'
        type: string

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v3
      
      - name: â” Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: ğŸ“¦ Install dependencies
        run: npm ci
      
      - name: ğŸ” TypeScript check
        run: npx tsc --noEmit || echo "TypeScript check optional"
      
      - name: ğŸ—ï¸ Build project
        run: npm run build
      
      - name: âœ… Validation passed
        run: echo "âœ… All validations passed! Ready for deployment."

  deploy:
    needs: validate
    if: github.event.inputs.confirm == 'DEPLOY'
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v3
      
      - name: ğŸš€ Deploy to Vercel
        uses: amondnet/vercel-action@v25
        id: vercel-deploy
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: ${{ github.event.inputs.environment == 'production' && '--prod' || '' }}
          github-comment: false
      
      - name: ğŸ“¢ Show deployment URLs
        run: |
          echo "========================================"
          echo "âœ… DEPLOYMENT SUCCESSFUL!"
          echo "========================================"
          if [ "${{ github.event.inputs.environment }}" = "production" ]; then
            echo "ğŸŒ Production: https://raziatech-quantum.vercel.app"
            echo "ğŸ”§ Admin: https://raziatech-quantum.vercel.app/admin"
            echo "ğŸ“Š Analytics: https://raziatech-quantum.vercel.app/admin/analytics"
          else
            echo "ğŸ”— Preview URL: https://${{ github.event.inputs.environment }}-raziatech-quantum.vercel.app"
          fi
          echo "ğŸ“… Deployed at: $(date)"
          echo "========================================"